<%

def map_user_defined_to_labels(properties)
  properties.map {|property| I18n.t("user_defined.#{property}")}
end

%>

<% if AppConfig.has_key?(:user_defined_in_basic) %>
    <%= javascript_include_tag "#{AppConfig[:frontend_prefix]}assets/user_defined_in_basic.js" %>

    <script>
     var record_type = '<%= controller.controller_name %>';
     var fields = <%= ASUtils.to_json(map_user_defined_to_labels(AppConfig[:user_defined_in_basic].fetch(controller.controller_name, []))).html_safe %>;
     var read_only_view = <%= controller.action_name == 'show' %>;
     
     var init = function () {
         setTimeout(function () {
             new UserDefinedInBasic().init(record_type, fields, read_only_view);
         }, 0);
     }

     // For Resource record updates
     $(document).bind("loadedrecordform.aspace", init);

     // For everything else
     init();

    </script>

<% end %>
