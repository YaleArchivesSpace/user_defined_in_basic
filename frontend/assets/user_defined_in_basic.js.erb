$(document).bind("loadedrecordform.aspace", init);

$(window).load(init);

function init() {
  if ($("#basic_information").find('.form-group').length == 0) {
    return;
  }

  var bi = document.getElementById("basic_information");
  var for_fld = bi.querySelector("label").getAttribute('for');

  if (for_fld == null) {
    return;
  }

  var record_type = '';
  if (for_fld.lastIndexOf('accession') === 0) {
    record_type = 'accession';
  } else if (for_fld.lastIndexOf('resource') === 0) {
    record_type = 'resource';
  } else if (for_fld.lastIndexOf('digital_object') === 0) {
    record_type = 'digital_object';
  } else {
    return;
  }

  var fields = {};
  <% ['accession', 'digital_object', 'resource'].each do |rec| %>
    <% if AppConfig[:user_defined_in_basic].has_key?(rec) %>
      fields['<%= rec %>'] = [];
      <% AppConfig[:user_defined_in_basic][rec].each do |fld| %>
        fields['<%= rec %>'].push('<%= fld %>');
      <% end %>
    <% end %>
  <% end %>

  if (fields[record_type] == null) {
    return;
  }

  // add user defined if necessary, and disable remove button
  var remove_btn = $('#'+record_type+'_user_defined_').find('.subrecord-form-remove');
  if (remove_btn.length == 0) {
    $('#'+record_type+'_user_defined_').find('.btn-default').filter(':visible').click();
    $('#'+record_type+'_user_defined_').find('.subrecord-form-remove').attr('disabled', 'disabled');
    window.scrollTo(0,0);
  } else {
    remove_btn.attr('disabled', 'disabled');
  }

  for (i = 0; i < fields[record_type].length; i++) {
    var field = fields[record_type][i];
    var fld_lab = document.getElementById(record_type + "_user_defined_").
                           querySelector("[for="+record_type+"_user_defined__"+field+"_]");

    if (fld_lab != null) {
      bi.insertBefore(fld_lab.parentElement, bi.querySelector("div.audit-display-wide"));
    }
  }
}
